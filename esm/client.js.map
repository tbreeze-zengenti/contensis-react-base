{"version":3,"file":"client.js","sources":["../src/client/client.tsx"],"sourcesContent":["import 'isomorphic-fetch';\nimport React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport { AppContainer } from 'react-hot-loader';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport { Router } from 'react-router-dom';\nimport { loadableReady } from '@loadable/component';\nimport { parse } from 'query-string';\nimport { CookiesProvider } from 'react-cookie';\n\nimport { selectVersionStatus } from '~/redux/selectors/version';\nimport { setVersionStatus } from '~/redux/actions/version';\nimport rootSaga from '~/redux/sagas';\nimport { browserHistory as history } from '~/redux/store/history';\nimport createStore from '~/redux/store/store';\n\nimport { setCurrentProject } from '~/routing/redux/actions';\n\nimport { deliveryApi } from '~/util/ContensisDeliveryApi';\nimport pickProject from '~/util/pickProject';\nimport { SSRContextProvider } from '~/util/SSRContext';\n\nimport { AppConfig, AppState } from '~/models';\n\ndeclare let window: typeof globalThis & {\n  isDynamic: boolean;\n  REDUX_DATA: AppState;\n};\n\ntype ReactAppProps = { routes: any; withEvents: any };\n\n// Fix TS2769 error No overload matches this call\nconst Container = AppContainer as any; // as typeof AppContainer;\n\nclass ClientApp {\n  constructor(ReactApp: React.ComponentType<ReactAppProps>, config: AppConfig) {\n    const documentRoot = document.getElementById('root');\n\n    const {\n      stateType = 'immutable',\n      routes,\n      withReducers,\n      withSagas,\n      withEvents,\n    } = config;\n\n    const GetClientJSX = store => {\n      const ClientJsx = (\n        <Container>\n          <CookiesProvider>\n            <ReduxProvider store={store}>\n              <Router history={history}>\n                <SSRContextProvider>\n                  <ReactApp routes={routes} withEvents={withEvents} />\n                </SSRContextProvider>\n              </Router>\n            </ReduxProvider>\n          </CookiesProvider>\n        </Container>\n      );\n      return ClientJsx;\n    };\n\n    const isProduction = !(process.env.NODE_ENV !== 'production');\n\n    /**\n     * Webpack HMR Setup.\n     */\n    const HMRRenderer = Component => {\n      if (isProduction)\n        loadableReady(\n          () => {\n            hydrate(Component, documentRoot);\n          },\n          { namespace: 'modern' }\n        );\n      else render(Component, documentRoot);\n    };\n\n    const hmr = store => {\n      // webpack Hot Module Replacement API\n      if (module.hot) {\n        module.hot.accept(ReactApp as unknown as string, () => {\n          // if you are using harmony modules ({modules:false})\n          HMRRenderer(GetClientJSX(store));\n        });\n      }\n    };\n\n    const qs = parse(window.location.search);\n    const versionStatus = deliveryApi.getClientSideVersionStatus();\n\n    if (\n      window.isDynamic ||\n      window.REDUX_DATA ||\n      process.env.NODE_ENV !== 'production'\n    ) {\n      createStore(withReducers, window.REDUX_DATA, history, stateType).then(\n        store => {\n          const state = store.getState();\n          const ssrVersionStatus = selectVersionStatus(state);\n          if (!ssrVersionStatus)\n            store.dispatch(setVersionStatus(versionStatus));\n\n          /* eslint-disable no-console */\n          console.log('Hydrating from inline Redux');\n          /* eslint-enable no-console */\n          store.runSaga(rootSaga(withSagas));\n          store.dispatch(\n            setCurrentProject(\n              pickProject(window.location.hostname, qs),\n              [],\n              window.location.hostname\n            )\n          );\n\n          delete (window as any).REDUX_DATA;\n          HMRRenderer(GetClientJSX(store));\n\n          hmr(store);\n        }\n      );\n    } else {\n      fetch(`${window.location.pathname}?redux=true`)\n        .then(response => response.json())\n        .then(data => {\n          const ssRedux = JSON.parse(data);\n          createStore(withReducers, ssRedux, history, stateType).then(store => {\n            store.dispatch(setVersionStatus(versionStatus));\n\n            store.runSaga(rootSaga(withSagas));\n            store.dispatch(\n              setCurrentProject(\n                pickProject(window.location.hostname, qs),\n                [],\n                window.location.hostname\n              )\n            );\n\n            HMRRenderer(GetClientJSX(store));\n\n            hmr(store);\n          });\n        });\n    }\n  }\n}\n\nexport default ClientApp;\n"],"names":["Container","AppContainer","ClientApp","constructor","ReactApp","config","documentRoot","document","getElementById","stateType","routes","withReducers","withSagas","withEvents","GetClientJSX","store","ClientJsx","React","createElement","CookiesProvider","ReduxProvider","Router","history","SSRContextProvider","isProduction","process","env","NODE_ENV","HMRRenderer","Component","loadableReady","hydrate","namespace","render","hmr","module","hot","accept","qs","parse","window","location","search","versionStatus","deliveryApi","getClientSideVersionStatus","isDynamic","REDUX_DATA","createStore","then","state","getState","ssrVersionStatus","selectVersionStatus","dispatch","setVersionStatus","console","log","runSaga","rootSaga","setCurrentProject","pickProject","hostname","fetch","pathname","response","json","data","ssRedux","JSON"],"mappings":"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"}